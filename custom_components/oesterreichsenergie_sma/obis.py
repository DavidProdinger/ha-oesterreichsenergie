# Extracted from https://oesterreichsenergie.at/fileadmin/user_upload/Smart_Meter-Plattform/20200201_Konzept_Kundenschnittstelle_SM.pdf
OBIS_CODES = {
    "0-0:1.0.0": "Date and time",
    "0-0:C.1.0": "Meter serial number",
    "1-0:1.8.0": "Forward active energy +A",
    "1-0:1.8.1": "",
    "1-0:1.8.2": "",
    "1-0:1.8.3": "",
    "1-0:1.8.4": "",
    "1-0:2.8.0": "Reverse active energy -A",
    "1-0:2.8.1": "",
    "1-0:2.8.2": "",
    "1-0:2.8.3": "",
    "1-0:2.8.4": "",
    "1-0:3.8.0": "Import reactive energy +R",
    "1-0:3.8.1": "",
    "1-0:3.8.2": "",
    "1-0:3.8.3": "",
    "1-0:3.8.4": "",
    "1-0:4.8.0": "Export reactive energy -R",
    "1-0:4.8.1": "",
    "1-0:4.8.2": "",
    "1-0:4.8.3": "",
    "1-0:4.8.4": "",
    "1-0:15.8.0": "Forward + Reverse active energy",
    "1-0:15.8.1": "",
    "1-0:15.8.2": "",
    "1-0:15.8.3": "",
    "1-0:15.8.4": "",
    "1-0:1.7.0": "Instantaneous forward active power +P",
    "1-0:2.7.0": "Instantaneous reverse active power -P",
    "1-0:3.7.0": "Instantaneous import reactive power +Q",
    "1-0:4.7.0": "Instantaneous export reactive power -Q",
    "1-0:32.7.0": "Instantaneous voltage L1",
    "1-0:52.7.0": "Instantaneous voltage L2",
    "1-0:72.7.0": "Instantaneous voltage L3",
    "1-0:31.7.0": "Instantaneous current L1",
    "1-0:51.7.0": "Instantaneous current L2",
    "1-0:71.7.0": "Instantaneous current L3",
    "1-0:1.6.0": "Maximum forward active power value",
    "1-0:15.35.0": "Power over limit threshold",
    "1-0:33.7.0": "Ch. 0; L1 Power factor; Inst. Value",
    "1-0:53.7.0": "Ch. 0; L2 Power factor; Inst. value",
    "1-0:73.7.0": "Ch. 0; L3 Power factor; Inst. value",
    "1-0:13.7.0": "Power Factor",
    "0-0:96.1.0": "Zählernummer des Netzbetreibers",
    "0-0:42.0.0": "COSEM logical device name",
    "0-0:0.9.1": "Datum und Zeit",
    "0-0:0.9.2": "Datum und Zeit",
    "1-1:1.8.0": "Zählerstand Energie A+ [Wh]",
    "1-1:2.8.0": "Zählerstand Energie A- [Wh]",
    "1-1:3.8.1": "Zählerstand Energie R+ [varh]",
    "1-1:4.8.1": "Zählerstand Energie R- [varh]",
    "1-1:1.7.0": "momentane Wirkleistung P+ [W]",
    "1-1:2.7.0": "momentane Wirkleistung P- [W]",
    "1-1:3.7.0": "momentane Blindleistung Q+ [var]",
    "1-1:4.7.0": "momentane Blindleistung Q- [var]",
    # conflict
    # "0-0:96.1.1": "Zählernummer des Netzbetreibers",
    "0-0:96.1.1": "Zeit",
    "0-0:96.1.2": "Datum",
    "0-0:96.13.0": "Kundeninformationstext",
    "0-0:96.13.1": "Kundeninformationscode",
    "0.0.1": "Zählernummer",
    "1-0:81.7.40": "Winkel U(L1) zu I(L1)",
    "1-0:81.7.51": "Winkel U(L2) zu I(L2)",
    "1-0:81.7.62": "Winkel U(L3) zu I(L3)",
    "1-3:0.2.8": "P1 port DSMR version",
}


def get_meter_number(data: dict) -> str | None:
    """Try to extract meter number from data."""
    meter_numbers = [
        "0-0:96.1.0",
        "0-0:96.1.1",
        "0.0.1",
    ]
    for k, v in data.items():
        if k in meter_numbers and len(v['value'] or v) > 0:
            return v['value']
    return None
